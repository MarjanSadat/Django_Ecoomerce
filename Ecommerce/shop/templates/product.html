{% extends 'base.html' %}
{% load humanize %}



{% block content %}   

  
    <div class='container'>
        <div class="card mb-3" >
            <div class="row g-0">
              <div class="col-md-4">
                <img src="{{product.picture.url}}" class="img-fluid rounded-start" alt="...">
              </div>
              <div class="col-md-8">
                <div class="card-body">
                    <h5 class="card-title">{{product.name}}</h5>
                    <p class="card-text">{{product.description | truncatewords:20}}</p>
                    <p class="card-text">
                        {% if product.is_sale %}
                            <strike>{{product.price | intcomma }}</strike><br>
                            {{product.sale_price | intcomma }}
                        {% else%}
                            {{product.price | intcomma }}
                        {% endif %}
                    </p>
                   Numbers: 
                    <select class="form-select" id="cart-qty">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="3">4</option>
                    </select>
                    <br><br>
                    <button class="btn btn-secondary" type="button" value="{{product.id}}" id="add-cart">Add To Cart</button>
                    <a href="{% url 'shop:products_view' %}" class="btn btn-secondary">Back To Main Page</a>
                </div>
              </div>
            </div>
          </div>
    </div>
    <br>
    <script>
      $(document).on('click', '#add-cart',function(e){
        e.preventDefault();
        $.ajax({
          type: 'POST',
          url: '{% url 'cart:cart_add' %}',
          data: {
            product_id: $('#add-cart').val(),
            product_qty: $('#cart-qty option:selected').text(),
            csrfmiddlewaretoken: '{{ csrf_token }}',
            action: 'post'
          },
          success: function(json){
            //console.log(json)
            document.getElementById('cart_quantity').textContent = json.qty;
            location.reload();
          },
          error: function(shr, errmsg, err){

          }
        })
      })
    </script>
{% endblock%}